-- Slave에서 Master로 권한 주기
GRANT INSERT, UPDATE, DELETE ON DB_HOUSE2.BOARD10 TO DB_HOUSE;

--한꺼번에 트리거
create or replace TRIGGER trg_board10_all
AFTER INSERT OR UPDATE OR DELETE ON DB_HOUSE.BOARD10
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        INSERT INTO DB_HOUSE2.BOARD10 (BSEQ, REGDATE, TESTSEQ, REGID, TITLE, CONTENTS)
        VALUES (:NEW.BSEQ, :NEW.REGDATE, :NEW.TESTSEQ, :NEW.REGID, :NEW.TITLE, :NEW.CONTENTS);

    ELSIF UPDATING THEN
        UPDATE DB_HOUSE2.BOARD10
        SET REGDATE = :NEW.REGDATE,
            TESTSEQ = :NEW.TESTSEQ,
            REGID = :NEW.REGID,
            TITLE = :NEW.TITLE,
            CONTENTS = :NEW.CONTENTS
        WHERE BSEQ = :NEW.BSEQ;

    ELSIF DELETING THEN
        DELETE FROM DB_HOUSE2.BOARD10
        WHERE BSEQ = :OLD.BSEQ;
    END IF;
END;

--DDL
CREATE TABLE "BOARD10"
(
    "BSEQ" NUMBER(19,0) NOT NULL ENABLE,
    "REGDATE" DATE DEFAULT SYSDATE,
    "TESTSEQ" NUMBER(19,0),
    "REGID" VARCHAR2(20 BYTE) DEFAULT 'testUser',
    "TITLE" VARCHAR2(50 CHAR) NOT NULL ENABLE,
    "CONTENTS" VARCHAR2(500 CHAR),
    PRIMARY KEY ("BSEQ")
);

-- 원본 테이블(DB_HOUSE.BOARD10)에서 삽입된 데이터를 동기화하는 트리거
CREATE OR REPLACE TRIGGER trg_board10_insert
AFTER INSERT ON DB_HOUSE.BOARD10
FOR EACH ROW
BEGIN
    INSERT INTO DB_HOUSE2.BOARD10 (BSEQ, REGDATE, REGID, TITLE, CONTENTS)
    VALUES (:NEW.BSEQ, :NEW.REGDATE, :NEW.REGID, :NEW.TITLE, :NEW.CONTENTS);
END;
/

-- 원본 테이블에서 업데이트된 데이터를 동기화하는 트리거
CREATE OR REPLACE TRIGGER trg_board10_update
AFTER UPDATE ON DB_HOUSE.BOARD10
FOR EACH ROW
BEGIN
    UPDATE DB_HOUSE2.BOARD10
    SET REGDATE = :NEW.REGDATE,
        REGID = :NEW.REGID,
        TITLE = :NEW.TITLE,
        CONTENTS = :NEW.CONTENTS
    WHERE BSEQ = :NEW.BSEQ;
END;
/

-- 원본 테이블에서 삭제된 데이터를 동기화하는 트리거
CREATE OR REPLACE TRIGGER trg_board10_delete
AFTER DELETE ON DB_HOUSE.BOARD10
FOR EACH ROW
BEGIN
    DELETE FROM DB_HOUSE2.BOARD10
    WHERE BSEQ = :OLD.BSEQ;
END;
/

CREATE TABLE BOARD10 (
    BSEQ NUMBER primary key,
	TITLE VARCHAR2(50 CHAR) NOT NULL,
	CONTENTS VARCHAR2(500 CHAR),
	REGID VARCHAR2(20 CHAR) default 'testUser',
	REGDATE DATE DEFAULT sysdate
);
